// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserRole {
  BOARD
  HR
  MANAGER
  EMPLOYEE
  GUEST
}

enum EmployeeStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
  TERMINATED
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  INTERVIEWED
  OFFERED
  ACCEPTED
  REJECTED
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum LeaveType {
  ANNUAL
  SICK
  PERSONAL
  MATERNITY
  PATERNITY
  UNPAID
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  ON_LEAVE
}

enum PerformanceRating {
  EXCELLENT
  GOOD
  SATISFACTORY
  NEEDS_IMPROVEMENT
  UNSATISFACTORY
}

// User Authentication
model User {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  email         String         @unique
  password      String
  role          UserRole       @default(EMPLOYEE)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  employee      Employee?
  sessions      Session[]
  accounts      Account[]
  notifications Notification[]
}

model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @db.ObjectId
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken String   @unique
  userId       String   @db.ObjectId
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Employee Management
model Employee {
  id               String         @id @default(auto()) @map("_id") @db.ObjectId
  employeeId       String         @unique
  userId           String         @unique @db.ObjectId
  firstName        String
  lastName         String
  middleName       String?
  dateOfBirth      DateTime?
  gender           String?
  phone            String?
  address          String?
  city             String?
  country          String?
  postalCode       String?
  emergencyContact String?
  emergencyPhone   String?
  hireDate         DateTime
  department       String?
  position         String?
  managerId        String?        @db.ObjectId
  status           EmployeeStatus @default(ACTIVE)
  salary           Float?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  manager             Employee?            @relation("EmployeeManager", fields: [managerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subordinates        Employee[]           @relation("EmployeeManager")
  attendances         Attendance[]
  leaves              Leave[]
  performanceReviews  PerformanceReview[]
  trainingEnrollments TrainingEnrollment[]
  payrollRecords      PayrollRecord[]
  benefitEnrollments  BenefitEnrollment[]
  educations          Education[]
  workExperiences     WorkExperience[]
  rewards             Reward[]
  disciplines         Discipline[]
  contracts           LaborContract[]
  documents           EmployeeDocument[]
  performanceGoals    PerformanceGoal[]
  insurances          Insurance[]
}

// Recruitment & Onboarding
model JobPosting {
  id             String           @id @default(auto()) @map("_id") @db.ObjectId
  title          String
  department     String
  description    String
  requirements   String
  location       String?
  employmentType String? // FULL_TIME, PART_TIME, CONTRACT
  salaryRange    String?
  status         String           @default("OPEN") // OPEN, CLOSED, FILLED
  postedDate     DateTime         @default(now())
  closingDate    DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  applications   JobApplication[]
}

model JobApplication {
  id            String            @id @default(auto()) @map("_id") @db.ObjectId
  jobPostingId  String            @db.ObjectId
  firstName     String
  lastName      String
  email         String
  phone         String?
  resume        String? // File path or URL
  coverLetter   String?
  status        ApplicationStatus @default(PENDING)
  appliedDate   DateTime          @default(now())
  interviewDate DateTime?
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  jobPosting JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
}

// Timekeeping & Attendance
model Attendance {
  id            String           @id @default(auto()) @map("_id") @db.ObjectId
  employeeId    String           @db.ObjectId
  date          DateTime
  checkIn       DateTime?
  checkOut      DateTime?
  breakDuration Int? // minutes
  totalHours    Float?
  status        AttendanceStatus @default(PRESENT)
  notes         String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
}

// Leave Management
model Leave {
  id              String      @id @default(auto()) @map("_id") @db.ObjectId
  employeeId      String      @db.ObjectId
  type            LeaveType
  startDate       DateTime
  endDate         DateTime
  days            Int
  reason          String?
  status          LeaveStatus @default(PENDING)
  approvedBy      String?
  approvedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Performance Evaluation
model PerformanceReview {
  id                  String            @id @default(auto()) @map("_id") @db.ObjectId
  employeeId          String            @db.ObjectId
  reviewPeriod        String // e.g., "Q1 2024", "2024 Annual"
  reviewDate          DateTime          @default(now())
  reviewerId          String? // Manager or HR who reviewed
  goals               String?
  achievements        String?
  strengths           String?
  areasForImprovement String?
  overallRating       PerformanceRating
  comments            String?
  employeeComments    String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Training & Development
model TrainingProgram {
  id          String               @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  category    String? // Technical, Soft Skills, Compliance, etc.
  duration    Int? // hours
  provider    String?
  cost        Float?
  startDate   DateTime?
  endDate     DateTime?
  status      String               @default("PLANNED") // PLANNED, ONGOING, COMPLETED, CANCELLED
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  enrollments TrainingEnrollment[]
}

model TrainingEnrollment {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  employeeId        String    @db.ObjectId
  trainingProgramId String    @db.ObjectId
  enrollmentDate    DateTime  @default(now())
  completionDate    DateTime?
  status            String    @default("ENROLLED") // ENROLLED, IN_PROGRESS, COMPLETED, CANCELLED
  score             Float?
  certificate       String? // File path or URL
  notes             String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  employee        Employee          @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  trainingProgram TrainingProgram   @relation(fields: [trainingProgramId], references: [id], onDelete: Cascade)
  feedback        TrainingFeedback?

  @@unique([employeeId, trainingProgramId])
}

// Payroll
model PayrollRecord {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  employeeId  String   @db.ObjectId
  payPeriod   String // e.g., "2024-01"
  baseSalary  Float
  allowances  Float    @default(0)
  deductions  Float    @default(0)
  overtime    Float    @default(0)
  bonuses     Float    @default(0)
  grossPay    Float
  netPay      Float
  tax         Float    @default(0)
  paymentDate DateTime
  status      String   @default("PENDING") // PENDING, PROCESSED, PAID
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, payPeriod])
}

// Benefits
model Benefit {
  id          String              @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  category    String? // Health, Retirement, Insurance, etc.
  coverage    String?
  eligibility String?
  cost        Float?
  isActive    Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  enrollments BenefitEnrollment[]
}

model BenefitEnrollment {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  employeeId     String    @db.ObjectId
  benefitId      String    @db.ObjectId
  enrollmentDate DateTime  @default(now())
  status         String    @default("ACTIVE") // ACTIVE, CANCELLED, EXPIRED
  coverageStart  DateTime?
  coverageEnd    DateTime?
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  benefit  Benefit  @relation(fields: [benefitId], references: [id], onDelete: Cascade)

  @@unique([employeeId, benefitId])
}

// Employee Education & Experience
model Education {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  employeeId  String    @db.ObjectId
  degree      String // Bachelor, Master, PhD, etc.
  field       String? // Computer Science, Business, etc.
  institution String
  startDate   DateTime?
  endDate     DateTime?
  gpa         Float?
  description String?
  certificate String? // File path or URL
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model WorkExperience {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  employeeId   String    @db.ObjectId
  company      String
  position     String
  startDate    DateTime
  endDate      DateTime?
  isCurrent    Boolean   @default(false)
  description  String?
  achievements String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Rewards & Discipline
model Reward {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  employeeId  String   @db.ObjectId
  title       String
  description String?
  rewardType  String // BONUS, CERTIFICATE, PROMOTION, etc.
  amount      Float?
  date        DateTime @default(now())
  payPeriod   String? // e.g., "2025-01" - tháng được thưởng
  awardedBy   String? // Manager or HR ID
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model Discipline {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  employeeId    String   @db.ObjectId
  title         String
  description   String?
  violationType String // WARNING, SUSPENSION, TERMINATION, etc.
  severity      String // MINOR, MODERATE, SEVERE
  date          DateTime @default(now())
  issuedBy      String? // Manager or HR ID
  actionTaken   String?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Labor Contracts
model LaborContract {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  employeeId     String    @db.ObjectId
  contractNumber String    @unique
  contractType   String // PERMANENT, TEMPORARY, PROBATION, etc.
  startDate      DateTime
  endDate        DateTime?
  isIndefinite   Boolean   @default(false)
  salary         Float?
  position       String?
  department     String?
  status         String    @default("ACTIVE") // ACTIVE, EXPIRED, TERMINATED
  document       String? // File path or URL
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Employee Documents
model EmployeeDocument {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  employeeId  String   @db.ObjectId
  name        String
  type        String // CV, CERTIFICATE, CONTRACT, ID_CARD, etc.
  filePath    String // File path or URL
  description String?
  uploadedBy  String? // User ID who uploaded
  accessLevel String   @default("EMPLOYEE") // EMPLOYEE, MANAGER, HR, BOARD
  uploadedAt  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Training Feedback
model TrainingFeedback {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  enrollmentId      String   @unique @db.ObjectId
  employeeId        String   @db.ObjectId
  trainingProgramId String   @db.ObjectId
  rating            Int // 1-5 scale
  contentRating     Int?
  instructorRating  Int?
  materialRating    Int?
  feedback          String?
  suggestions       String?
  wouldRecommend    Boolean?
  submittedAt       DateTime @default(now())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  enrollment TrainingEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
}

// Performance Goals
model PerformanceGoal {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  employeeId   String   @db.ObjectId
  title        String
  description  String?
  targetValue  Float?
  currentValue Float?   @default(0)
  unit         String? // percentage, number, etc.
  startDate    DateTime
  endDate      DateTime
  status       String   @default("IN_PROGRESS") // NOT_STARTED, IN_PROGRESS, COMPLETED, CANCELLED
  progress     Float    @default(0) // 0-100
  assignedBy   String? // Manager or HR ID
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Insurance Management
model Insurance {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  employeeId    String    @db.ObjectId
  insuranceType String // HEALTH, SOCIAL, UNEMPLOYMENT, etc.
  policyNumber  String?
  provider      String?
  startDate     DateTime
  endDate       DateTime?
  premium       Float?
  coverage      String?
  status        String    @default("ACTIVE") // ACTIVE, EXPIRED, CANCELLED
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// Notifications
model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  title     String
  message   String
  type      String // CONTRACT_EXPIRY, PAYROLL, LEAVE_APPROVAL, etc.
  isRead    Boolean  @default(false)
  link      String? // URL to related page
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
